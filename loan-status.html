<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Application Status ‚Äî AutoHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            background: #f4f6fb;
            font-family: 'Segoe UI', sans-serif;
        }

        /* Navbar */
        .los-navbar {
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 0.65rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .los-brand {
            font-size: 1.3rem;
            font-weight: 800;
            color: #5b2ec9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .los-brand-icon {
            background: #5b2ec9;
            color: #fff;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .los-nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .los-search {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 0.4rem 0.9rem;
            font-size: 0.85rem;
            background: #f8f8f8;
            outline: none;
            width: 200px;
        }

        .los-avatar {
            width: 34px;
            height: 34px;
            background: #e8e0fb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5b2ec9;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .page-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 1.5rem 1.5rem 4rem;
        }

        .back-link {
            color: #555;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            margin-bottom: 1.25rem;
        }

        .back-link:hover {
            color: #5b2ec9;
        }

        .page-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #222;
            margin-bottom: 1.5rem;
        }

        /* Bank header card */
        .bank-header-card {
            background: linear-gradient(135deg, #1a3a5c 60%, #0e7a72 100%);
            color: #fff;
            border-radius: 14px;
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .bank-name {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .bank-flag {
            background: #dc3545;
            color: #fff;
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
        }

        .bank-loan-amount {
            font-size: 1rem;
            font-weight: 700;
        }

        /* Progress timeline */
        .progress-section {
            background: #fff;
            border-radius: 14px;
            padding: 1.5rem 2rem;
            margin-bottom: 1.25rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .progress-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .progress-title {
            font-weight: 700;
            font-size: 1rem;
        }

        .status-disbursed {
            background: #ede9fb;
            color: #5b2ec9;
            font-size: 0.78rem;
            font-weight: 700;
            padding: 0.3rem 0.9rem;
            border-radius: 20px;
        }

        .timeline-wrap {
            position: relative;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .timeline {
            display: flex;
            align-items: flex-start;
            position: relative;
            min-width: 700px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 12px;
            left: 0;
            right: 0;
            height: 3px;
            background: #5b2ec9;
            z-index: 0;
        }

        .timeline-step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .timeline-circle {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #5b2ec9;
            color: #fff;
            font-size: 0.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #fff;
            box-shadow: 0 0 0 2px #5b2ec9;
        }

        .timeline-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: #333;
            text-align: center;
            margin-top: 0.5rem;
        }

        .timeline-date {
            font-size: 0.62rem;
            color: #888;
            text-align: center;
            margin-top: 0.2rem;
        }

        /* Detail sections */
        .detail-section {
            background: #fff;
            border-radius: 14px;
            padding: 1.5rem 2rem;
            margin-bottom: 1.25rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: #222;
            margin-bottom: 1.25rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem 2rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-size: 0.82rem;
            color: #666;
        }

        .detail-value {
            font-size: 0.85rem;
            font-weight: 700;
            color: #222;
            text-align: right;
        }

        /* Document section */
        .doc-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.85rem 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .doc-row:last-child {
            border-bottom: none;
        }

        .doc-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .doc-icon {
            color: #dc3545;
            font-size: 1.1rem;
        }

        .doc-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #222;
        }

        .doc-size {
            font-size: 0.75rem;
            color: #999;
        }

        .doc-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-doc-download {
            background: #f0ebff;
            color: #5b2ec9;
            border: none;
            border-radius: 7px;
            padding: 0.4rem 0.85rem;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-doc-download:hover {
            background: #e0d5ff;
        }

        .btn-doc-view {
            background: #5b2ec9;
            color: #fff;
            border: none;
            border-radius: 7px;
            padding: 0.4rem 0.85rem;
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-doc-view:hover {
            background: #4820a8;
        }

        /* Repayment Schedule Modal */
        .rep-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            z-index: 1000;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 1rem;
            overflow-y: auto;
        }

        .rep-modal-overlay.active {
            display: flex;
        }

        .rep-modal {
            background: #fff;
            border-radius: 16px;
            width: 100%;
            max-width: 820px;
            padding: 2rem;
            position: relative;
            margin: auto;
            animation: repIn 0.2s ease-out;
        }

        @keyframes repIn {
            from {
                transform: translateY(-20px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .rep-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #eee;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rep-title {
            font-weight: 800;
            font-size: 1.1rem;
            color: #222;
            margin-bottom: 0.25rem;
        }

        .rep-sub {
            font-size: 0.82rem;
            color: #888;
            margin-bottom: 1.25rem;
        }

        .rep-summary {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            background: #f8f6ff;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.25rem;
        }

        .rep-sum-item label {
            font-size: 0.72rem;
            color: #888;
            display: block;
            margin-bottom: 0.15rem;
        }

        .rep-sum-item span {
            font-weight: 700;
            font-size: 0.9rem;
            color: #5b2ec9;
        }

        .rep-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.82rem;
        }

        .rep-table th {
            background: #f8f8f8;
            font-weight: 700;
            color: #555;
            padding: 0.65rem 0.85rem;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .rep-table td {
            padding: 0.6rem 0.85rem;
            border-bottom: 1px solid #f3f3f3;
            text-align: center;
            color: #333;
        }

        .rep-table tr:last-child td {
            border-bottom: none;
            font-weight: 700;
            background: #fff8ee;
        }

        .rep-table .paid-row td {
            background: #f6fff6;
            color: #1a7a3a;
        }

        .rep-note {
            font-size: 0.75rem;
            color: #aaa;
            text-align: center;
            margin-top: 0.85rem;
        }

        .btn-download-schedule {
            background: #5b2ec9;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.55rem 1.25rem;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Sanction Letter View Modal */
        .sl-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .sl-modal-overlay.active {
            display: flex;
        }

        .sl-modal {
            background: #fff;
            border-radius: 14px;
            width: 100%;
            max-width: 680px;
            padding: 2rem;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            animation: repIn 0.2s ease-out;
        }

        .sl-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #eee;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sl-letterhead {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 2rem;
            font-size: 0.82rem;
            color: #333;
            line-height: 1.7;
        }

        .sl-letterhead h3 {
            color: #1a3a5c;
        }
    </style>
</head>

<body>

    <!-- Navbar -->
    <div class="los-navbar">
        <div class="los-brand">
            <div class="los-brand-icon"><i class="fas fa-home"></i></div>
            LOS
        </div>
        <div class="los-nav-right">
            <input class="los-search" placeholder="üîç  Search">
            <i class="fas fa-bell text-muted" style="font-size:1.1rem; cursor:pointer;"></i>
            <span class="badge rounded-pill bg-danger" style="margin-left:-0.75rem; font-size:0.6rem;">3</span>
            <div class="los-avatar">SL</div>
            <span style="font-size:0.85rem; font-weight:600; color:#333;">Satish L.</span>
        </div>
    </div>

    <div class="page-container">
        <a href="javascript:history.back()" class="back-link"><i class="fas fa-arrow-left"></i> View Loan Application
            Details</a>

        <!-- Bank Header -->
        <div class="bank-header-card">
            <div class="bank-name"><span class="bank-flag">üè¶</span> HDFC Bank</div>
            <div class="bank-loan-amount">Loan Amount : ‚Çπ 5,00,000</div>
        </div>

        <!-- Progress Timeline -->
        <div class="progress-section">
            <div class="progress-section-header">
                <div class="progress-title">Progress</div>
                <span class="status-disbursed">Disbursed</span>
            </div>
            <div class="timeline-wrap">
                <div class="timeline">
                    <div class="timeline-step">
                        <div class="timeline-circle">1</div>
                        <div class="timeline-label">Application<br>Submitted</div>
                        <div class="timeline-date">20 Aug 2025 12:30:00</div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-circle">2</div>
                        <div class="timeline-label">Offer<br>Generated</div>
                        <div class="timeline-date">20 Aug 2025 12:30:00</div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-circle">3</div>
                        <div class="timeline-label">Offer<br>Applied</div>
                        <div class="timeline-date">20 Aug 2025 01:30:00</div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-circle">4</div>
                        <div class="timeline-label">Underwriting</div>
                        <div class="timeline-date">22 Aug 2025 12:30:00</div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-circle">5</div>
                        <div class="timeline-label">Sanctioned</div>
                        <div class="timeline-date">23 Aug 2025 12:30:00</div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-circle">6</div>
                        <div class="timeline-label">Accepted</div>
                        <div class="timeline-date">24 Aug 2025 12:30:00</div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-circle">7</div>
                        <div class="timeline-label">Disbursed</div>
                        <div class="timeline-date">25 Aug 2025 12:30:00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Application Details -->
        <div class="detail-section">
            <div class="section-title">Application Details</div>
            <div class="detail-grid">
                <div>
                    <div class="detail-row"><span class="detail-label">Applicant</span><span class="detail-value">Ankit
                            Kapile</span></div>
                    <div class="detail-row"><span class="detail-label">PAN</span><span class="detail-value">1234 1234
                            1234</span></div>
                    <div class="detail-row"><span class="detail-label">Product / Cart</span><span
                            class="detail-value text-truncate" id="productDisplay"
                            style="max-width: 200px;">Business_Loan</span></div>
                    <div class="detail-row"><span class="detail-label">Total Purchase Value</span><span
                            class="detail-value" id="purchaseValueDisplay">‚Çπ
                            5,00,000</span></div>
                </div>
                <div>
                    <div class="detail-row"><span class="detail-label">Tenure of Loan</span><span
                            class="detail-value">24 Months</span></div>
                    <div class="detail-row"><span class="detail-label">Annual Interest Rate</span><span
                            class="detail-value">8.5 %</span></div>
                    <div class="detail-row"><span class="detail-label">Lender</span><span class="detail-value">NTSL
                            Pvt.Ltd</span></div>
                    <div class="detail-row"><span class="detail-label">Channel</span><span class="detail-value">Managing
                            Direct</span></div>
                </div>
            </div>
        </div>

        <!-- Sanctioned Details -->
        <div class="detail-section">
            <div class="section-title">Sanctioned Details</div>
            <div class="detail-grid">
                <div>
                    <div class="detail-row"><span class="detail-label">Amount Sanctioned</span><span
                            class="detail-value">‚Çπ 5,00,000</span></div>
                    <div class="detail-row"><span class="detail-label">Date</span><span class="detail-value">25 Aug 2025
                            12:30:00</span></div>
                </div>
                <div>
                    <div class="detail-row"><span class="detail-label">Annual Interest Rate</span><span
                            class="detail-value">8.5%</span></div>
                    <div class="detail-row"><span class="detail-label">Tenure Of Loan</span><span
                            class="detail-value">24 Months</span></div>
                </div>
            </div>
        </div>

        <!-- Disbursal Details -->
        <div class="detail-section">
            <div class="section-title">Disbursal Details</div>
            <div class="detail-grid">
                <div>
                    <div class="detail-row"><span class="detail-label">Amount Credited</span><span
                            class="detail-value text-success" id="disbursedAmountDisplay">‚Çπ 5,00,000</span></div>
                    <div class="detail-row"><span class="detail-label">Date</span><span class="detail-value">25 Aug 2025
                            12:30:00</span></div>
                </div>
                <div>
                    <div class="detail-row"><span class="detail-label">UTR</span><span
                            class="detail-value">NTS20250814000123</span></div>
                    <div class="detail-row"><span class="detail-label">Account</span><span class="detail-value">HDFC
                            Bank ‚Ä¢‚Ä¢‚Ä¢‚Ä¢0911</span></div>
                </div>
            </div>
        </div>

        <!-- Post-Disbursal Payment (Own Contribution) -->
        <div class="detail-section border border-primary shadow-sm" id="postDisbursementSection" style="display: none;">
            <div class="section-title text-primary"><i class="fas fa-exclamation-circle me-1"></i> Pending Payment: Own
                Contribution</div>
            <p class="text-muted small mb-3">Your loan has been successfully disbursed. Please pay your own contribution
                to complete the purchase and begin delivery processes.</p>
            <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded mb-3">
                <span class="fw-bold">Total Remaining Balance</span>
                <span class="fs-4 fw-bold text-danger" id="remainingBalanceDisplay">‚Çπ 0</span>
            </div>
            <div class="text-end">
                <button class="btn btn-primary" id="payRemainingBtn"><i class="fas fa-credit-card me-2"></i>Pay
                    Now</button>
            </div>

            <!-- Success state (hidden initially) -->
            <div id="paymentSuccessState" style="display: none;" class="text-center py-4">
                <i class="fas fa-check-circle text-success mb-2" style="font-size: 3rem;"></i>
                <h5 class="fw-bold text-success">Payment Successful</h5>
                <p class="text-muted">Purchase completed successfully. Vendor has been notified.</p>
            </div>
        </div>

        <!-- Documents -->
        <div class="detail-section">
            <div class="section-title">Document</div>
            <div class="doc-row">
                <div class="doc-info">
                    <i class="fas fa-file-pdf doc-icon"></i>
                    <div>
                        <div class="doc-name">Sanction Letter .pdf</div>
                        <div class="doc-size">2.50 MB</div>
                    </div>
                </div>
                <div class="doc-actions">
                    <button class="btn-doc-download" onclick="downloadDoc('Sanction_Letter.pdf')">
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button class="btn-doc-view" onclick="viewSanctionLetter()">
                        <i class="fas fa-eye"></i> View
                    </button>
                </div>
            </div>
            <div class="doc-row">
                <div class="doc-info">
                    <i class="fas fa-table doc-icon" style="color:#5b2ec9;"></i>
                    <div>
                        <div class="doc-name">Repayment Schedule</div>
                        <div class="doc-size">24 installments</div>
                    </div>
                </div>
                <div class="doc-actions">
                    <button class="btn-doc-view" onclick="viewRepaymentSchedule()">
                        <i class="fas fa-eye"></i> View
                    </button>
                </div>
            </div>
        </div>
    </div><!-- /page-container -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SANCTION LETTER VIEW MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="sl-modal-overlay" id="slModalOverlay">
        <div class="sl-modal">
            <button class="sl-modal-close" onclick="closeSLModal()">‚úï</button>
            <h5 class="mb-3" style="font-weight:800;">Sanction Letter</h5>
            <div class="sl-letterhead">
                <h3>HDFC Bank Limited</h3>
                <p style="font-size:0.75rem;color:#888;">HDFC Bank House, Senapati Bapat Marg, Lower Parel, Mumbai ‚Äì 400
                    013</p>
                <hr>
                <p><strong>Date:</strong> 25 August 2025</p>
                <p><strong>To,</strong><br>Ankit Kapile<br>123, Main Street, Bangalore ‚Äì 560001</p>
                <p>Dear Ankit Kapile,</p>
                <p>We are pleased to inform you that your loan application (Ref: LOS/HDFC/2025/00124) has been
                    <strong>sanctioned</strong> subject to the following terms and conditions:
                </p>
                <table style="width:100%;border-collapse:collapse;margin:1rem 0;">
                    <tr style="background:#f8f8f8;">
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;font-weight:600;">Loan Amount</td>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;">‚Çπ 5,00,000 (Rupees Five Lakhs only)
                        </td>
                    </tr>
                    <tr>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;font-weight:600;">Rate of Interest</td>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;">8.5% p.a. (Fixed)</td>
                    </tr>
                    <tr style="background:#f8f8f8;">
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;font-weight:600;">Tenure</td>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;">24 Months</td>
                    </tr>
                    <tr>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;font-weight:600;">EMI</td>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;">‚Çπ 17,200/- per month</td>
                    </tr>
                    <tr style="background:#f8f8f8;">
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;font-weight:600;">Processing Fee</td>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;">‚Çπ 231.00</td>
                    </tr>
                    <tr>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;font-weight:600;">Purpose</td>
                        <td style="padding:0.4rem 0.75rem;border:1px solid #eee;">Business Loan</td>
                    </tr>
                </table>
                <p>This sanction is valid for <strong>30 days</strong> from the date of this letter. Please sign and
                    return the duplicate copy of this letter as your acceptance of the above terms.</p>
                <p style="margin-top:2rem;">Yours faithfully,<br><strong>HDFC Bank Limited</strong><br><em>Authorized
                        Signatory</em></p>
            </div>
            <div class="d-flex justify-content-end mt-3">
                <button class="btn-doc-download me-2" onclick="downloadDoc('Sanction_Letter.pdf')"><i
                        class="fas fa-download me-1"></i>Download</button>
                <button class="btn-doc-view" onclick="printDoc()"><i class="fas fa-print me-1"></i>Print</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REPAYMENT SCHEDULE MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="rep-modal-overlay" id="repModalOverlay">
        <div class="rep-modal">
            <button class="rep-modal-close" onclick="closeRepModal()">‚úï</button>
            <div class="rep-title">Repayment Schedule</div>
            <div class="rep-sub">HDFC Bank ‚Äî Loan Ref: LOS/HDFC/2025/00124 | Start Date: 1 Oct 2025</div>

            <div class="rep-summary">
                <div class="rep-sum-item"><label>Loan Amount</label><span>‚Çπ 5,00,000</span></div>
                <div class="rep-sum-item"><label>Interest Rate</label><span>8.5% p.a.</span></div>
                <div class="rep-sum-item"><label>Monthly EMI</label><span>‚Çπ 17,200</span></div>
                <div class="rep-sum-item"><label>Total Tenure</label><span>24 Months</span></div>
                <div class="rep-sum-item"><label>Total Payable</label><span>‚Çπ 5,43,518</span></div>
                <div class="rep-sum-item"><label>Total Interest</label><span>‚Çπ 43,518</span></div>
            </div>

            <div style="overflow-x:auto;max-height:55vh;overflow-y:auto;">
                <table class="rep-table" id="repTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Due Date</th>
                            <th>EMI (‚Çπ)</th>
                            <th>Principal (‚Çπ)</th>
                            <th>Interest (‚Çπ)</th>
                            <th>Outstanding (‚Çπ)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="repTableBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
            <p class="rep-note">* Interest calculated on reducing balance method. Rows in green indicate paid
                installments.</p>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <span class="text-muted small">Prepayment charges: 2% on outstanding principal</span>
                <button class="btn-download-schedule" onclick="downloadSchedule()">
                    <i class="fas fa-download"></i> Download Schedule
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/store.js"></script>
    <script>
        // ‚îÄ‚îÄ Post Disbursement Flow ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.addEventListener("DOMContentLoaded", () => {
            const app = store.getApplication();

            if (app && app.productName) {
                document.getElementById('productDisplay').textContent = app.productName;
                document.getElementById('purchaseValueDisplay').textContent = '‚Çπ ' + (app.productPrice || 0).toLocaleString('en-IN');
                document.getElementById('disbursedAmountDisplay').textContent = '‚Çπ ' + (app.loanAmount || 0).toLocaleString('en-IN');

                // Post-disbursement Logic
                const ownContrib = app.ownContribution || 0;

                // In a real app we would check application status. For demo, we assume status is Disbursed.
                if (!app.orderCreated) {
                    // Create Master Order marking purchase as Complete (but pending downpayment)
                    const subOrders = app.subOrders || [];
                    const computedSubOrders = subOrders.map(so => {
                        if (so.seller_id === app.downpaymentSeller && ownContrib > 0) {
                            return {
                                ...so,
                                payout_status: 'Pending Downpayment',
                                pending_downpayment: ownContrib
                            };
                        } else {
                            return {
                                ...so,
                                payout_status: 'Paid' // Covered purely by loan
                            };
                        }
                    });

                    const masterOrder = {
                        id: app.masterOrderId || ('ORD-' + Date.now()),
                        date: new Date().toLocaleDateString(),
                        items: app.vehicles || [{ name: app.productName, price: app.productPrice }],
                        total: app.grandTotal || app.productPrice,
                        status: ownContrib > 0 ? 'Pending Downpayment' : 'Completed',
                        paymentMode: 'Finance + Self',
                        loanStatus: 'Disbursed',
                        payment_status: ownContrib > 0 ? 'Pending' : 'Paid',
                        subOrders: computedSubOrders
                    };
                    store.addOrder(masterOrder);

                    app.orderCreated = true;
                    store.saveApplication(app);
                }

                if (ownContrib > 0 && !app.contributionPaid) {
                    const postSection = document.getElementById('postDisbursementSection');
                    postSection.style.display = 'block';
                    document.getElementById('remainingBalanceDisplay').textContent = '‚Çπ ' + ownContrib.toLocaleString('en-IN');

                    document.querySelector('#postDisbursementSection > p').innerHTML =
                        '<i class="fas fa-info-circle me-1"></i> Loan amount disbursed to marketplace. Please pay your own contribution from the <strong>My Orders</strong> dashboard to complete the sequence.';

                    const payBtn = document.getElementById('payRemainingBtn');
                    payBtn.textContent = 'Pay Now';
                    payBtn.addEventListener('click', () => {
                        window.location.href = 'orders.html';
                    });
                }
            }
        });

        // ‚îÄ‚îÄ Repayment Schedule Generation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function generateSchedule() {
            const principal = 500000;
            const annualRate = 8.5;
            const tenure = 24;
            const monthlyRate = annualRate / 100 / 12;
            const emi = Math.round(principal * monthlyRate * Math.pow(1 + monthlyRate, tenure) / (Math.pow(1 + monthlyRate, tenure) - 1));

            let outstanding = principal;
            let rows = '';
            const startYear = 2025; const startMonth = 10; // Oct 2025

            for (let i = 1; i <= tenure; i++) {
                const interest = Math.round(outstanding * monthlyRate);
                const principalPaid = emi - interest;
                outstanding = Math.max(0, outstanding - principalPaid);
                const dueDate = new Date(startYear, startMonth - 1 + i, 1);
                const dateStr = dueDate.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
                // First 2 months marked as paid (for demo)
                const isPaid = i <= 2;
                rows += `<tr class="${isPaid ? 'paid-row' : ''}">
                <td>${i}</td>
                <td>${dateStr}</td>
                <td>${emi.toLocaleString('en-IN')}</td>
                <td>${principalPaid.toLocaleString('en-IN')}</td>
                <td>${interest.toLocaleString('en-IN')}</td>
                <td>${outstanding.toLocaleString('en-IN')}</td>
                <td><span class="badge ${isPaid ? 'bg-success' : 'bg-light text-muted'}">${isPaid ? 'Paid' : 'Pending'}</span></td>
            </tr>`;
            }
            document.getElementById('repTableBody').innerHTML = rows;
        }

        // ‚îÄ‚îÄ Modal Controls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function viewRepaymentSchedule() {
            generateSchedule();
            document.getElementById('repModalOverlay').classList.add('active');
        }
        function closeRepModal() {
            document.getElementById('repModalOverlay').classList.remove('active');
        }
        function viewSanctionLetter() {
            document.getElementById('slModalOverlay').classList.add('active');
        }
        function closeSLModal() {
            document.getElementById('slModalOverlay').classList.remove('active');
        }

        // Close modals on overlay click
        document.getElementById('repModalOverlay').addEventListener('click', function (e) { if (e.target === this) closeRepModal(); });
        document.getElementById('slModalOverlay').addEventListener('click', function (e) { if (e.target === this) closeSLModal(); });

        function downloadDoc(filename) {
            // Simulate download: create a blob and trigger download
            const content = `HDFC Bank ‚Äî ${filename}\nLoan Ref: LOS/HDFC/2025/00124\nAmount: Rs 5,00,000\nDate: 25 Aug 2025`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = filename; a.click();
            URL.revokeObjectURL(url);
        }

        function downloadSchedule() {
            const rows = [['#', 'Due Date', 'EMI', 'Principal', 'Interest', 'Outstanding', 'Status']];
            const principal = 500000;
            const monthlyRate = 8.5 / 100 / 12;
            const tenure = 24;
            const emi = Math.round(principal * monthlyRate * Math.pow(1 + monthlyRate, tenure) / (Math.pow(1 + monthlyRate, tenure) - 1));
            let outstanding = principal;
            for (let i = 1; i <= tenure; i++) {
                const interest = Math.round(outstanding * monthlyRate);
                const principalPaid = emi - interest;
                outstanding = Math.max(0, outstanding - principalPaid);
                const dueDate = new Date(2025, 9 + i, 1);
                rows.push([i, dueDate.toLocaleDateString('en-IN'), emi, principalPaid, interest, outstanding, i <= 2 ? 'Paid' : 'Pending']);
            }
            const csv = rows.map(r => r.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'Repayment_Schedule_HDFC.csv'; a.click();
            URL.revokeObjectURL(url);
        }

        function printDoc() {
            window.print();
        }
    </script>
</body>

</html>